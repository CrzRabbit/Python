'''
在一个 N x N 的坐标方格 grid 中，每一个方格的值 grid[i][j] 表示在位置 (i,j) 的平台高度。

现在开始下雨了。当时间为 t 时，此时雨水导致水池中任意位置的水位为 t 。你可以从一个平台游向四周相邻的任意一个平台，但是前提是此时水位必须同时淹没这两个平台。假定你可以瞬间移动无限距离，也就是默认在方格内部游动是不耗时的。当然，在你游泳的时候你必须待在坐标方格里面。

你从坐标方格的左上平台 (0，0) 出发。最少耗时多久你才能到达坐标方格的右下平台 (N-1, N-1)？


示例 1:

输入: [[0,2],[1,3]]
输出: 3
解释:
时间为0时，你位于坐标方格的位置为 (0, 0)。
此时你不能游向任意方向，因为四个相邻方向平台的高度都大于当前时间为 0 时的水位。
等时间到达 3 时，你才可以游向平台 (1, 1). 因为此时的水位是 3，坐标方格中的平台没有比水位 3 更高的，所以你可以游向坐标方格中的任意位置

示例2:

输入: [[0,1,2,3,4],[24,23,22,21,5],[12,13,14,15,16],[11,17,18,19,20],[10,9,8,7,6]]
输出: 16
解释:
 0  1  2  3  4
24 23 22 21  5
12 13 14 15 16
11 17 18 19 20
10  9  8  7  6

最终的路线用加粗进行了标记。
我们必须等到时间为 16，此时才能保证平台 (0, 0) 和 (4, 4) 是连通的

提示:

2 <= N <= 50.
grid[i][j] 是 [0, ..., N*N - 1] 的排列。
'''
from typing import List

from leetcode.tools.time import printTime


class Solution:
    @printTime()
    def swimInWater(self, grid: List[List[int]]) -> int:
        n = len(grid)
        fa = [i for i in range(n * n)]
        rank = [1 for _ in range(n * n)]
        vis = [[False for _ in range(n)] for _ in range(n)]
        def find(idx):
            if idx == fa[idx]:
                return fa[idx]
            fa[idx] = find(fa[idx])
            return fa[idx]
        def merge(idx1, idx2):
            fa1 = find(idx1)
            fa2 = find(idx2)
            if rank[fa1] >= rank[fa2]:
                fa[fa2] = fa1
            else:
                fa[fa1] = fa2
            if rank[fa1] == rank[fa2] and fa1 != fa2:
                rank[fa1] += 1
        for k in range(n**2):
            for i in range(n):
                for j in range(n):
                    if not vis[i][j] and k >= grid[i][j]:
                        if i > 0 and k >= grid[i - 1][j]:
                            merge((i - 1) * n + j, i * n + j)
                        if j > 0 and k >= grid[i][j - 1]:
                            merge(i * n + j - 1, i * n + j)
                        if i < n - 1 and k >= grid[i + 1][j]:
                            merge((i + 1) * n + j, i * n + j)
                        if j < n - 1 and k >= grid[i][j + 1]:
                            merge(i * n + j + 1, i * n + j)
                        if find(0) == find(i * n + j):
                            vis[i][j] = True
                        if find(0) == find(n ** 2 - 1):
                            return k
        return n ** 2 - 1

grid = [[1255,1197,1157,120,1097,815,8,1323,676,1227,1560,1715,665,2063,1113,1260,1575,53,2328,802,294,1954,2391,225,466,1713,2301,474,1223,2016,1296,1695,921,904,1867,2083,666,395,985,222,2005,1449,800,2058,1872,1605,2117,1310,912],[608,1067,1235,1467,623,2214,745,1997,154,171,661,1717,971,1547,2338,1845,1000,2309,194,1027,1847,1158,1822,169,1519,327,872,1312,263,1810,61,1931,2020,1033,1780,389,951,1783,762,1385,2251,299,888,107,2344,575,1851,1523,1438],[1023,536,328,700,1189,609,1294,870,2208,2270,2335,952,1873,487,33,50,507,1502,2052,721,2289,1149,1109,1894,1505,100,1619,923,1797,121,825,963,1409,768,1955,1944,2001,750,2009,662,1487,214,2080,1556,1626,1228,1804,614,1663],[1994,737,899,1907,2302,959,1564,493,11,1861,1152,380,279,1779,1959,1735,2167,303,24,469,2269,809,1115,992,521,1332,2000,1300,2293,1699,2145,2297,146,2142,1057,3,1303,1937,1417,1291,199,1069,1138,1493,1163,525,842,99,1414],[2340,926,1490,2093,1167,1737,840,1866,2121,2337,1841,126,2151,1265,839,1392,2065,1482,1532,864,561,1248,1466,1038,2282,330,1581,1791,1761,1308,338,1421,2180,563,31,378,2361,118,342,1270,2278,163,2347,675,340,1628,239,272,1624],[683,1217,200,1689,471,1531,2239,518,691,1941,211,1086,367,231,824,502,1528,2164,973,682,1445,2368,460,7,1688,1940,845,2355,1720,2163,836,830,1742,1698,571,1203,2363,598,1559,1821,549,1817,866,1942,2273,792,1641,1928,823],[2044,767,871,515,2079,362,1241,283,219,1503,1301,2029,1087,1757,2173,2109,1052,254,1044,1839,564,965,1998,286,861,1419,950,1290,919,1374,1677,1613,976,1982,2294,1373,1026,741,1520,604,2327,1437,2119,1436,1028,490,322,429,1478],[2385,384,2050,1897,1361,1527,125,1693,806,744,2257,241,1399,827,896,2351,485,2047,188,517,445,1517,309,1278,631,540,707,627,1565,551,1205,1415,2053,1001,1404,813,1644,374,1999,319,2014,1176,911,2299,516,2281,2333,2343,2045],[766,983,1363,168,1844,2274,1351,1396,274,205,475,481,659,1733,1269,1050,1685,1025,1629,1479,2202,1343,114,1215,1500,705,1541,1725,641,2248,261,1039,1313,696,1588,2358,9,1888,1608,1369,1169,994,2336,1828,142,510,1162,1578,1252],[72,1283,266,1668,718,1881,1422,1229,1391,2089,361,1602,622,2300,13,1394,1794,302,2188,155,1127,1473,1096,1326,733,208,907,651,403,351,1759,862,1117,1976,981,2245,652,1956,1106,2099,2380,1686,605,166,1948,1640,1836,1037,366],[308,295,1342,1006,1540,2228,746,353,970,1860,1403,2205,335,991,1388,2175,1468,368,1784,663,1021,1011,630,1639,2132,1543,1793,344,1122,674,1549,2074,2030,2036,467,2043,1989,1537,1382,1463,1975,2259,376,2068,751,2106,1339,2241,2037],[738,1508,1985,1567,333,1416,38,435,1536,197,2081,2390,1048,1740,177,1818,1259,236,868,128,1334,1667,2033,370,2059,1184,2218,967,1815,2290,1591,2229,43,2220,1004,1451,1287,749,1679,1586,1922,427,64,513,526,2154,2112,1813,684],[2379,1992,1579,727,291,895,1371,108,2191,183,955,273,1562,1201,1951,1511,986,156,1692,2153,1256,1902,2,290,1923,1352,432,2287,2392,138,1085,1447,1018,430,2267,530,421,1171,522,647,1830,2325,2071,391,832,2207,46,2201,1472],[1177,2022,1136,1862,1996,1604,1133,1512,65,553,1491,1625,1285,352,483,232,436,1696,1988,759,1749,1264,713,1829,593,613,811,1094,109,2136,372,2313,349,388,67,885,947,1583,1652,2090,1524,917,1653,874,1697,892,207,931,1743],[1202,1250,644,412,198,14,220,1336,679,1521,396,1978,111,1193,2004,599,140,2051,1781,2399,297,743,804,1459,1408,1921,1513,1185,1566,479,643,227,1454,1855,1230,1166,944,2226,1407,1277,901,134,89,1912,401,754,1569,269,858],[499,477,1003,1430,1346,1284,890,1546,625,2230,356,1413,249,1658,565,75,1120,1932,164,1620,1518,2272,2212,489,2304,1650,1875,854,398,1900,1424,2183,1838,193,247,379,2221,2129,2155,1453,810,1186,1555,519,488,2141,841,681,1221],[1368,1273,456,191,1142,506,1194,1924,1012,1984,1148,337,1809,532,318,1317,149,2015,937,1090,147,1918,1803,209,161,2400,1934,612,1632,1684,1756,689,793,1218,1080,1047,1972,2019,2232,685,2386,1182,505,2162,677,803,785,394,1669],[1568,987,1395,514,1344,2387,2311,1425,63,454,930,240,1807,2169,1946,786,954,752,903,2067,377,887,1592,245,1919,586,2264,1741,2086,204,402,1156,905,2210,1768,1209,1114,719,1366,116,1375,1081,1350,1266,268,176,2388,187,144],[601,628,606,2114,2268,843,1174,2394,442,122,58,1116,2150,1121,492,567,1840,1271,584,592,1302,2176,537,1483,1718,1076,833,1943,1494,2246,1916,1573,936,2234,900,464,1582,1656,1869,23,437,2389,1736,834,1833,2092,672,2018,818],[2061,999,259,588,2133,1208,1347,2360,78,1599,579,1819,180,223,2197,1935,1593,1362,68,756,2371,2104,66,1801,1991,1222,960,1431,332,476,2156,334,45,69,1272,990,127,1558,2345,877,1013,924,1370,799,2028,1753,1879,585,2140],[988,914,1075,2166,1676,1161,701,1210,1638,764,1383,316,817,1137,151,993,703,2308,1196,325,880,1330,415,1055,918,250,1655,812,178,1030,157,1574,852,478,1495,568,1723,1234,2134,1477,1631,383,1348,1863,1529,1849,589,1664,1464],[1788,897,73,83,363,484,1338,1146,545,603,1577,1708,757,848,1548,699,1501,1298,1886,2107,1771,438,559,110,728,103,2263,945,1814,646,1816,1654,1929,769,346,2094,1005,801,791,124,583,958,1240,2317,1292,876,724,2157,739],[531,433,1971,1164,2158,1905,1726,671,1917,132,618,996,434,1331,1207,535,980,1864,2165,2373,135,104,940,550,1314,1734,849,1206,819,182,1032,781,1766,18,82,1510,1253,315,1603,1420,1444,1322,381,270,1458,2049,2035,369,1381],[1434,1199,112,2260,1938,1481,511,2046,486,1078,1871,1837,1195,600,509,761,587,162,2292,1261,1665,2171,253,1890,2098,1059,1739,1530,2382,1995,2131,906,1544,1074,51,1802,101,1101,1365,345,2041,1318,1751,2315,2209,360,2091,1800,1785],[1452,21,1099,1155,393,772,392,129,2225,321,881,1986,2031,296,2323,523,611,784,1914,1542,298,714,409,1282,2149,778,1390,1926,1190,2184,71,55,30,925,1636,805,1980,697,977,428,81,1670,1457,1965,2378,1329,649,669,301],[468,1611,2306,150,271,2192,1587,1633,80,1041,2265,736,2238,2088,2021,760,1386,1324,1455,201,37,851,364,1014,717,1704,1043,1949,1456,2102,397,56,648,404,1220,462,267,1952,1760,2084,2295,1570,2161,635,557,246,660,1355,277],[455,1711,626,27,539,202,555,722,2006,1110,576,265,2025,1913,2123,1358,1910,1337,407,35,218,2177,730,2181,572,1925,2261,668,882,494,1823,1159,1889,1440,1651,1834,305,1507,2146,657,224,1545,989,1393,939,1354,1349,59,2189],[230,1868,533,306,1674,1554,624,70,1446,1882,79,1178,2076,1666,386,1968,956,1378,406,1617,2078,1903,2040,495,1878,2364,1747,789,2113,196,1920,2193,2211,774,1469,285,1485,902,2179,2216,2143,1470,1606,595,2012,2103,1246,1535,119],[1901,732,734,946,847,1226,788,927,678,916,1967,276,1966,1750,558,638,1947,307,443,1405,2186,1049,2039,1731,1017,1790,1707,281,508,616,2148,731,1309,1040,408,2250,1319,1738,93,1561,1092,451,1694,1506,243,884,1236,256,2213],[2366,2187,74,2227,2359,820,141,2110,1854,1153,1009,2277,426,2284,2357,922,1279,1129,358,2069,424,341,1589,972,1242,1372,461,2101,863,387,2352,1418,482,1722,348,2125,857,1856,48,1071,859,837,1251,1088,2285,1825,1732,1964,807],[913,528,329,1671,94,1060,1970,1134,304,2199,964,96,2135,2172,465,617,597,2127,1538,1286,1389,723,1064,288,1594,1042,1957,317,883,1084,1401,2178,264,1180,1514,85,347,2256,2130,418,1498,313,2120,1728,1848,1610,962,1095,878],[2291,1293,1077,1526,217,440,28,1539,1647,2222,1191,503,1553,419,2353,920,472,1144,1979,1400,998,2017,1831,1690,1598,280,670,501,1423,1927,1380,1212,1906,634,1056,1340,1883,25,1895,410,1721,1460,1263,1295,2266,934,2013,1755,829],[1786,1796,282,2054,1911,1798,1643,192,1063,1576,1065,1820,1853,1876,790,221,770,105,2376,2395,1730,1891,1580,1497,235,431,2011,2319,1219,1410,2003,292,76,1772,794,2122,1211,228,2244,1379,1135,2010,2224,1091,1634,420,1325,566,1376],[2072,42,975,1183,708,690,310,1962,19,1789,2060,1105,654,1145,534,1585,1909,355,2369,1899,20,979,2042,1151,633,190,2346,29,1249,339,982,312,1870,1367,244,498,15,1701,137,1335,1015,1782,997,1345,1762,1328,160,1471,1776],[1746,1154,1710,1306,1939,1214,1492,1082,1131,694,1429,1402,698,331,1187,1160,580,90,782,2124,1239,2159,2321,1908,1682,2316,2381,2139,2242,1945,62,640,2354,1843,1973,632,251,1680,780,2314,875,1691,620,1516,40,1275,704,773,1596],[16,1428,1433,1147,1614,1846,2082,1311,1880,1764,1993,932,948,1724,172,350,206,765,497,1139,1877,1128,1364,949,2286,229,1054,538,195,2375,2396,1509,1571,2204,1111,1898,2258,1125,255,2370,1238,300,2217,133,1769,747,1615,1646,41],[2048,2168,1204,1073,457,1933,529,1333,524,844,725,929,1987,1224,2198,1462,1257,165,1961,86,667,2350,2066,262,1441,1496,658,590,226,1384,650,2026,1051,821,87,375,491,248,2070,77,1448,1305,1474,52,856,2367,582,710,543],[1744,84,928,136,591,1727,1439,2398,2312,2307,1089,179,1299,1489,39,278,2334,459,1533,2062,686,2194,1247,1600,2182,984,692,2275,894,1687,1752,814,909,1824,1859,175,777,1225,1775,500,390,527,693,1678,961,159,2332,755,753],[1637,213,908,1356,1572,1534,1486,2296,1729,610,1007,1974,574,480,1705,449,1590,898,1053,5,1811,2144,98,411,343,12,1675,1981,838,1778,1353,1112,2320,1716,581,148,242,453,1936,1031,1835,2115,95,1119,1812,2262,1061,578,1008],[2075,470,547,203,1551,234,1175,1622,1681,1748,546,1983,1232,2057,1024,873,2231,1188,1852,729,47,2064,602,2095,2023,542,1618,1465,1795,57,1274,36,1597,2233,1280,910,2160,1630,2365,1719,886,1432,44,189,1341,1435,2002,712,1179],[2372,1268,373,1045,915,758,422,1763,1808,816,1499,400,1140,943,1108,1426,607,323,2356,953,1649,569,1887,153,771,656,1412,2374,158,2111,145,2215,2349,680,1832,1254,2324,828,1977,867,2206,763,995,570,1036,826,1662,2116,1035],[1826,113,2077,413,34,233,6,2118,1315,320,1103,2305,167,938,1173,2331,835,174,966,1712,139,1773,850,2152,1034,1616,1930,2240,1745,2055,1892,968,1276,1953,1165,695,957,102,359,1029,26,2038,1316,787,2341,2255,1262,97,1893],[1621,1387,1398,2108,2105,1858,237,289,444,1058,1563,1874,1525,2339,706,783,2027,416,2190,796,688,2330,594,22,891,1200,935,1244,629,2247,1357,2348,311,720,92,1170,1461,115,642,1896,2200,1019,284,1126,385,2174,1806,2097,448],[1079,2128,1102,1552,715,1281,2243,1181,2073,709,354,1475,1360,711,1321,1609,1969,702,1046,552,1612,865,1258,49,573,1118,1198,775,2326,1950,1320,2377,2393,130,405,1072,1787,1132,1406,1450,287,942,1297,1709,1104,1172,447,2310,60],[2219,210,1958,1754,458,548,978,1070,2137,637,1857,1243,17,1443,1093,336,184,1289,1660,1601,1124,2329,1661,32,797,1083,1642,216,748,554,0,275,106,1068,1,1767,653,181,619,450,2185,869,1672,740,1770,2271,2096,496,822],[831,1484,1098,1884,1016,293,186,2056,1397,2138,1141,1792,1427,88,2254,853,776,2249,855,152,2223,91,252,173,645,735,1963,399,1327,2147,2126,2384,2280,1245,1213,54,1130,1304,2383,425,673,123,1799,562,314,889,639,1020,143],[2034,596,2252,382,257,2276,544,504,2024,238,860,846,2203,615,2303,1915,2085,893,621,1645,1267,1765,1659,556,258,2008,1627,1476,1842,941,664,2322,1504,1522,512,1550,1702,716,1557,1960,1657,2362,10,371,2253,1488,1683,185,441],[1706,1714,1805,1233,1774,1143,933,1002,417,1411,687,365,779,212,1827,1904,2288,1359,798,215,452,655,1990,260,131,1377,1850,1231,520,1777,808,974,726,2007,1168,2100,1480,357,1010,636,1648,414,324,2196,326,1100,1307,1123,1758],[1623,1673,541,1703,1066,117,577,2279,969,1107,439,1607,879,2195,1192,1865,2236,446,1237,2032,1442,423,1150,2170,1885,2235,2342,463,1022,473,1216,1062,1595,4,1700,742,1515,2237,2318,560,2087,1635,170,2397,1288,2298,1584,795,2283]]
Solution().swimInWater(grid)